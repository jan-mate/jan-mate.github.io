<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Birthday Peculiarities</title>
    <style>
        table {
            border-collapse: collapse;
            width: 30%;
            margin-top: 20px;
            margin-right: 10px;
            float: left;
        }
        th, td {
            border: 1px solid black;
            text-align: left;
            padding: 8px;
        }
        th {
            background-color: #f2f2f2;
        }
        .underline {
            text-decoration: underline;
        }
        #chart-container {
            width: 70%;
            margin: 40px auto;
        }
        .clear {
            clear: both;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <h1>Birthday Peculiarities</h1>
    <p>I was born on 2004-02-25, but I will have lived for 21 years on 2025-02-24.
       This is because birthdays don't take into account leap years.
       I was born 02-25 on a leap year, which means it was 366 days till it was 02-25 again.
       So on 2005-02-25, I was actually 366/365.2425 = 1.0021 average Gregorian years.
       But I was born at 13:55, and 2004-02-25 13:55 + 365.2425 days ends up being 2005-02-24 18:44:42,
       so I had already lived for 1 average Gregorian year on 02-24.
        This pattern continues for the rest of my life. Which means birthdays can change.
    </p>
    <p>Here's a calculator to enter your birthdatetime to see when you will be different ages:</p>
    
    <label for="birthDate">Enter your birthdatetime (YYYY-MM-DD HH:MM:SS):</label>
    <input type="text" id="birthDate" value="2004-02-25 13:55:00">
    <br>
    <label for="minAge">Enter minimum age to calculate:</label>
    <input type="number" id="minAge" value="20">
    <br>
    <label for="maxAge">Enter maximum age to calculate:</label>
    <input type="number" id="maxAge" value="30">
    <br><br>
    <button onclick="calculateFutureDates()">Calculate</button>

    <table id="futureDatesTable">
        <thead>
            <tr>
                <th>Age</th>
                <th>Datetime</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>

    <div id="chart-container">
        <canvas id="birthdayChart"></canvas>
    </div>

    <div class="clear"></div>

    <div id="frequency-container">
        <h3>Frequency of Each Day</h3>
        <div id="tables">
            <table id="frequencyTableModular">
                <thead>
                    <tr>
                        <th>Day</th>
                        <th>Frequency</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
            <table id="frequencyTableLifeExpectancy">
                <thead>
                    <tr>
                        <th>Day</th>
                        <th>Frequency</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
            <table id="frequencyTable400Years">
                <thead>
                    <tr>
                        <th>Day</th>
                        <th>Frequency</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        let birthdayChart; // Declare the chart variable outside to allow updating
        const lifeExpectancy = 85;

        function calculateFutureDates() {
            const birthDateString = document.getElementById('birthDate').value;
            const minAge = parseInt(document.getElementById('minAge').value);
            const maxAge = parseInt(document.getElementById('maxAge').value);

            if (isNaN(minAge) || isNaN(maxAge) || minAge < 0 || maxAge < 0 || minAge > maxAge) {
                alert("Please enter valid minimum and maximum ages. Minimum age must be 0 or greater and less than or equal to maximum age.");
                return;
            }

            const birthDateTime = new Date(birthDateString.replace(' ', 'T'));

            if (isNaN(birthDateTime.getTime())) {
                alert("Please enter a valid ISO format datetime (YYYY-MM-DD HH:MM:SS).");
                return;
            }

            const secondsInYear = 365.2425 * 24 * 60 * 60; // seconds in a Gregorian year
            const futureDatesTable = document.getElementById('futureDatesTable').getElementsByTagName('tbody')[0];
            futureDatesTable.innerHTML = ''; // Clear previous results

            const dates = [];
            const ages = [];
            let minDay = Number.MAX_SAFE_INTEGER;
            let maxDay = Number.MIN_SAFE_INTEGER;

            for (let age = minAge; age <= maxAge; age++) {
                const totalSecondsToAdd = age * secondsInYear;
                const futureDateTime = new Date(birthDateTime.getTime() + totalSecondsToAdd * 1000);
                let futureDateFormatted = futureDateTime.toISOString().replace('T', ' ').split('.')[0];

                const dateParts = futureDateFormatted.split(' ');
                const datePart = dateParts[0].split('-');
                const day = parseInt(datePart[2], 10);
                minDay = Math.min(minDay, day);
                maxDay = Math.max(maxDay, day);
                datePart[2] = `<span class="underline">${day}</span>`;
                futureDateFormatted = datePart.join('-') + ' ' + dateParts[1];

                const newRow = futureDatesTable.insertRow();
                const cellAge = newRow.insertCell(0);
                const cellDate = newRow.insertCell(1);

                cellAge.textContent = age;
                cellDate.innerHTML = futureDateFormatted;

                // Store the day and age for plotting
                dates.push(day);
                ages.push(age);
            }

            // If the chart already exists, destroy it before creating a new one
            if (birthdayChart) {
                birthdayChart.destroy();
            }

            plotBirthdays(ages, dates, minDay, maxDay);
            calculateFrequencies(dates, minAge, maxAge, birthDateTime);
        }

        function plotBirthdays(ages, dates, minDay, maxDay) {
            const ctx = document.getElementById('birthdayChart').getContext('2d');
            birthdayChart = new Chart(ctx, {
                type: 'scatter', // Change to 'scatter' for dots only
                data: {
                    labels: ages,
                    datasets: [{
                        label: 'Day of Birthday',
                        data: ages.map((age, index) => ({ x: age, y: dates[index] })), // Map the ages and dates to {x, y} format
                        borderColor: 'rgba(75, 192, 192, 1)',
                        backgroundColor: 'rgba(75, 192, 192, 1)', // Color of the dots
                        borderWidth: 1,
                        showLine: false, // Disable the line
                    }]
                },
                options: {
                    scales: {
                        y: {
                            title: {
                                display: true,
                                text: 'Day of Month'
                            },
                            ticks: {
                                stepSize: 1
                            },
                            min: minDay,
                            max: maxDay
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Age'
                            },
                            type: 'linear',
                            min: Math.min(...ages), // Ensure the x-axis starts at the minAge
                            max: Math.max(...ages)  // Ensure the x-axis ends at the maxAge
                        }
                    }
                }
            });
        }

        function calculateFrequencies(dates, minAge, maxAge, birthDateTime) {
            // Calculate frequencies for modular, life expectancy, and 400 years
            const modularFrequency = calculateFrequency(dates);
            const lifeExpectancyDates = generateDates(birthDateTime, lifeExpectancy);
            const lifeExpectancyFrequency = calculateFrequency(lifeExpectancyDates);
            const years400Dates = generateDates(birthDateTime, 400);
            const years400Frequency = calculateFrequency(years400Dates);

            // Display the tables
            displayFrequencyTable(modularFrequency, 'frequencyTableModular', minAge, maxAge);
            displayFrequencyTable(lifeExpectancyFrequency, 'frequencyTableLifeExpectancy', 0, lifeExpectancy);
            displayFrequencyTable(years400Frequency, 'frequencyTable400Years', 0, 400);
        }

        function calculateFrequency(dates) {
            return dates.reduce((acc, day) => {
                acc[day] = (acc[day] || 0) + 1;
                return acc;
            }, {});
        }

        function generateDates(birthDateTime, years) {
            const dates = [];
            const secondsInYear = 365.2425 * 24 * 60 * 60;
            for (let age = 0; age <= years; age++) {
                const totalSecondsToAdd = age * secondsInYear;
                const futureDateTime = new Date(birthDateTime.getTime() + totalSecondsToAdd * 1000);
                const futureDateFormatted = futureDateTime.toISOString().split('T')[0];
                const day = parseInt(futureDateFormatted.split('-')[2], 10);
                dates.push(day);
            }
            return dates;
        }

        function displayFrequencyTable(dayCounts, tableId, startAge, endAge) {
    const frequencyTable = document.getElementById(tableId);
    frequencyTable.innerHTML = ''; // Clear any existing content

    const caption = frequencyTable.createCaption();
    caption.innerHTML = `<strong>Frequency Table for Ages ${startAge} to ${endAge}</strong>`;

    const thead = document.createElement('thead');
    thead.innerHTML = `
        <tr>
            <th>Day</th>
            <th>Frequency</th>
        </tr>`;
    frequencyTable.appendChild(thead);

    const tbody = document.createElement('tbody');
    let totalDays = 0;
    let totalCount = 0;

    for (let day = 0; day <= 31; day++) {
        const count = dayCounts[day] || 0;
        if (count > 0) {  // Only display rows where the count is greater than 0
            const newRow = tbody.insertRow();
            const cellDay = newRow.insertCell(0);
            const cellCount = newRow.insertCell(1);

            cellDay.textContent = day;
            cellCount.textContent = count;

            // Accumulate total days and counts for average calculation
            totalDays += day * count;
            totalCount += count;
        }
    }

    // Calculate the average day
    const averageDay = (totalCount > 0) ? (totalDays / totalCount).toFixed(2) : 0;

    // Add a row to display the average
    const averageRow = tbody.insertRow();
    const averageCellDay = averageRow.insertCell(0);
    const averageCellCount = averageRow.insertCell(1);
    averageCellDay.textContent = 'Average';
    averageCellCount.textContent = averageDay;

    frequencyTable.appendChild(tbody);
}



document.addEventListener('DOMContentLoaded', (event) => {
    calculateFutureDates();
});

    </script>
</body>
</html>
